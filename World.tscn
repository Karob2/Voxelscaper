[gd_scene load_steps=25 format=2]

[ext_resource path="res://Voxels.tscn" type="PackedScene" id=1]
[ext_resource path="res://art/brickwall.png" type="Texture" id=2]
[ext_resource path="res://art/sandbrick.png" type="Texture" id=3]
[ext_resource path="res://art/sfdsfgrtj.png" type="Texture" id=4]
[ext_resource path="res://World.gd" type="Script" id=5]
[ext_resource path="res://art/grid.png" type="Texture" id=6]
[ext_resource path="res://VertEditPanel.gd" type="Script" id=7]
[ext_resource path="res://font/IBMPlexSans-Medium.ttf" type="DynamicFontData" id=8]
[ext_resource path="res://VertEditInputCatcher.gd" type="Script" id=9]
[ext_resource path="res://art/minigrid.png" type="Texture" id=10]
[ext_resource path="res://MenuBar.gd" type="Script" id=11]

[sub_resource type="Environment" id=3]
background_mode = 1
background_color = Color( 0.486275, 0.654902, 0.835294, 1 )
ambient_light_color = Color( 1, 1, 1, 1 )
ambient_light_energy = 0.1
ambient_light_sky_contribution = 0.0

[sub_resource type="SpatialMaterial" id=28]
params_diffuse_mode = 1
albedo_texture = ExtResource( 2 )

[sub_resource type="SpatialMaterial" id=29]
params_diffuse_mode = 1
albedo_texture = ExtResource( 3 )

[sub_resource type="ArrayMesh" id=30]
surfaces/0 = {
"aabb": AABB( -0.5, -0.5, -0.5, 1, 1, 1.00001 ),
"array_data": PoolByteArray( 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 0, 63, 1, 128, 0, 0, 78, 45, 253, 59, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 0, 191, 1, 128, 0, 0, 211, 14, 253, 59, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 63, 1, 128, 0, 0, 78, 45, 2, 58, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 191, 1, 128, 0, 0, 211, 14, 2, 58, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 0, 191, 255, 127, 0, 0, 78, 45, 253, 59, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 0, 63, 255, 127, 0, 0, 211, 14, 253, 59, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 191, 255, 127, 0, 0, 78, 45, 2, 58, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 63, 255, 127, 0, 0, 211, 14, 2, 58, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 0, 191, 255, 127, 255, 127, 78, 45, 253, 59, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 0, 191, 255, 127, 255, 127, 211, 14, 253, 59, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 191, 255, 127, 255, 127, 78, 45, 2, 58, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 191, 255, 127, 255, 127, 211, 14, 2, 58, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 0, 78, 45, 253, 59, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 0, 211, 14, 253, 59, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 0, 78, 45, 2, 58, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 0, 211, 14, 2, 58 ),
"array_index_data": PoolByteArray( 0, 0, 1, 0, 2, 0, 2, 0, 1, 0, 3, 0, 4, 0, 5, 0, 6, 0, 6, 0, 5, 0, 7, 0, 8, 0, 9, 0, 10, 0, 10, 0, 9, 0, 11, 0, 12, 0, 13, 0, 14, 0, 14, 0, 13, 0, 15, 0 ),
"blend_shape_data": [  ],
"format": 2194707,
"index_count": 24,
"material": SubResource( 28 ),
"primitive": 4,
"skeleton_aabb": [  ],
"vertex_count": 16
}
surfaces/1 = {
"aabb": AABB( -0.5, -0.5, -0.5, 1.00001, 1.00001, 1.00001 ),
"array_data": PoolByteArray( 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 255, 127, 78, 45, 253, 59, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 255, 127, 211, 14, 253, 59, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 255, 127, 78, 45, 2, 58, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 255, 127, 211, 14, 2, 58, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 1, 128, 78, 45, 253, 59, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 1, 128, 211, 14, 253, 59, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 1, 128, 78, 45, 2, 58, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 1, 128, 211, 14, 2, 58 ),
"array_index_data": PoolByteArray( 0, 0, 1, 0, 2, 0, 2, 0, 1, 0, 3, 0, 4, 0, 5, 0, 6, 0, 6, 0, 5, 0, 7, 0 ),
"blend_shape_data": [  ],
"format": 2194707,
"index_count": 12,
"material": SubResource( 29 ),
"primitive": 4,
"skeleton_aabb": [  ],
"vertex_count": 8
}

[sub_resource type="SpatialMaterial" id=11]
flags_unshaded = true
vertex_color_use_as_albedo = true
params_diffuse_mode = 2
params_billboard_mode = 2
params_use_alpha_scissor = true
params_alpha_scissor_threshold = 0.98
albedo_texture = ExtResource( 4 )

[sub_resource type="GDScript" id=12]
script/source = "extends Sprite3D


# Declare member variables here. Examples:
# var a = 2
# var b = \"text\"


# Called when the node enters the scene tree for the first time.
func _ready():
    pass # Replace with function body.

func do_cast(offset : Vector3 = Vector3()):
    var light : DirectionalLight = get_parent().get_node(\"DirectionalLight\")
    var cast : RayCast = RayCast.new()
    add_child(cast)
    cast.global_transform.origin = global_transform.origin + offset
    cast.cast_to = light.global_transform.origin - cast.global_transform.origin
    cast.cast_to = cast.cast_to.normalized()
    cast.cast_to *= light.directional_shadow_max_distance
    cast.force_raycast_update()
    #var raw_collision_point = null
    #var collision_point = null
    #var collision_normal = null
    cast.queue_free()
    return cast.is_colliding()


# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
    var offsets = [Vector3(), Vector3(0, -0.25, 0), Vector3(0, 0.5, 0)]
    var amount = 0.0
    for offset in offsets:
        if do_cast(offset):
            amount += 1.0/offsets.size()
    var target_color = Color(1.00, 1.00, 1.00).linear_interpolate(Color(0.25, 0.25, 0.25), amount)
    modulate = modulate.linear_interpolate(target_color, 1.0 - pow(0.001, delta))
    
    pass
"

[sub_resource type="SpatialMaterial" id=7]
flags_transparent = true
flags_unshaded = true
vertex_color_use_as_albedo = true
albedo_color = Color( 0.168627, 0.47451, 1, 0.321569 )

[sub_resource type="Environment" id=19]
ambient_light_color = Color( 0.623529, 0.623529, 0.623529, 1 )
ambient_light_sky_contribution = 0.0

[sub_resource type="World" id=20]
environment = SubResource( 19 )

[sub_resource type="SpatialMaterial" id=31]
params_diffuse_mode = 1
albedo_texture = ExtResource( 2 )

[sub_resource type="SpatialMaterial" id=32]
params_diffuse_mode = 1
albedo_texture = ExtResource( 3 )

[sub_resource type="ArrayMesh" id=33]
surfaces/0 = {
"aabb": AABB( -0.5, -0.5, -0.5, 1, 1, 1.00001 ),
"array_data": PoolByteArray( 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 0, 63, 1, 128, 0, 0, 78, 45, 253, 59, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 0, 191, 1, 128, 0, 0, 211, 14, 253, 59, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 63, 1, 128, 0, 0, 78, 45, 2, 58, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 191, 1, 128, 0, 0, 211, 14, 2, 58, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 0, 191, 255, 127, 0, 0, 78, 45, 253, 59, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 0, 63, 255, 127, 0, 0, 211, 14, 253, 59, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 191, 255, 127, 0, 0, 78, 45, 2, 58, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 63, 255, 127, 0, 0, 211, 14, 2, 58, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 0, 191, 255, 127, 255, 127, 78, 45, 253, 59, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 0, 191, 255, 127, 255, 127, 211, 14, 253, 59, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 191, 255, 127, 255, 127, 78, 45, 2, 58, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 191, 255, 127, 255, 127, 211, 14, 2, 58, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 0, 78, 45, 253, 59, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 0, 211, 14, 253, 59, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 0, 78, 45, 2, 58, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 0, 211, 14, 2, 58 ),
"array_index_data": PoolByteArray( 0, 0, 1, 0, 2, 0, 2, 0, 1, 0, 3, 0, 4, 0, 5, 0, 6, 0, 6, 0, 5, 0, 7, 0, 8, 0, 9, 0, 10, 0, 10, 0, 9, 0, 11, 0, 12, 0, 13, 0, 14, 0, 14, 0, 13, 0, 15, 0 ),
"blend_shape_data": [  ],
"format": 2194707,
"index_count": 24,
"material": SubResource( 31 ),
"primitive": 4,
"skeleton_aabb": [  ],
"vertex_count": 16
}
surfaces/1 = {
"aabb": AABB( -0.5, -0.5, -0.5, 1.00001, 1.00001, 1.00001 ),
"array_data": PoolByteArray( 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 255, 127, 78, 45, 253, 59, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 255, 127, 211, 14, 253, 59, 0, 0, 0, 63, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 255, 127, 78, 45, 2, 58, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 255, 127, 211, 14, 2, 58, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 1, 128, 78, 45, 253, 59, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 0, 63, 0, 0, 1, 128, 211, 14, 253, 59, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 1, 128, 78, 45, 2, 58, 0, 0, 0, 63, 0, 0, 0, 191, 0, 0, 0, 191, 0, 0, 1, 128, 211, 14, 2, 58 ),
"array_index_data": PoolByteArray( 0, 0, 1, 0, 2, 0, 2, 0, 1, 0, 3, 0, 4, 0, 5, 0, 6, 0, 6, 0, 5, 0, 7, 0 ),
"blend_shape_data": [  ],
"format": 2194707,
"index_count": 12,
"material": SubResource( 32 ),
"primitive": 4,
"skeleton_aabb": [  ],
"vertex_count": 8
}

[sub_resource type="DynamicFont" id=27]
size = 18
use_mipmaps = true
use_filter = true
font_data = ExtResource( 8 )

[node name="World" type="Spatial" groups=["VoxEditor"]]
script = ExtResource( 5 )

[node name="DirectionalLight" type="DirectionalLight" parent="." groups=["Sun"]]
transform = Transform( 0.707107, 0.5, -0.5, 0, 0.707107, 0.707107, 0.707107, -0.5, 0.5, -5, 8, 5 )
shadow_enabled = true
shadow_bias = 0.0
directional_shadow_normal_bias = 0.25

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource( 3 )

[node name="CameraHolder" type="Spatial" parent="."]
transform = Transform( 0.707107, -0.353553, 0.612372, 0, 0.866025, 0.5, -0.707107, -0.353553, 0.612372, 0, 1, 0 )

[node name="Camera" type="Camera" parent="CameraHolder"]
transform = Transform( 1, 0, 0, 0, 1, -8.34465e-07, 0, 8.04663e-07, 1, 0, 0, 10 )
projection = 1
current = true
fov = 45.0
size = 10.0

[node name="Voxels" parent="." instance=ExtResource( 1 )]
mesh = SubResource( 30 )

[node name="Sprite3D" type="Sprite3D" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0 )
visible = false
material_override = SubResource( 11 )
generate_lightmap = false
offset = Vector2( 0, 8 )
pixel_size = 0.0625
billboard = 2
shaded = true
double_sided = false
alpha_cut = 1
texture = ExtResource( 4 )
script = SubResource( 12 )

[node name="ButtonGrid" type="OptionButton" parent="."]
margin_left = 8.0
margin_top = 190.0
margin_right = 176.0
margin_bottom = 227.0
hint_tooltip = "Grid rendering"

[node name="ButtonWarp" type="OptionButton" parent="."]
margin_left = 8.0
margin_top = 153.0
margin_right = 176.0
margin_bottom = 190.0
hint_tooltip = "Cursor alignment technique when using \"Add\" mode with \"Draw\""

[node name="ButtonTool" type="OptionButton" parent="."]
margin_left = 8.0
margin_top = 116.0
margin_right = 176.0
margin_bottom = 153.0
hint_tooltip = "Drawing tool placement mode.
Place: Place a single block, like minecraft.
Draw: Continuously draw, like an image editor.

HINT: Draw mode direction follows the face you click down on to start drawing."

[node name="ButtonMode" type="OptionButton" parent="."]
margin_left = 8.0
margin_top = 79.0
margin_right = 176.0
margin_bottom = 116.0
hint_tooltip = "Drawing mode
Add: Place a block on top of the surface.
Replace: Replace the given block.
Add (vertical only): Add but vertically aligned \"draw\" mode.
Add (horizontal only): Add but horizontally aligned \"draw\" mode."

[node name="ButtonPerspective" type="OptionButton" parent="."]
margin_left = 8.0
margin_top = 42.0
margin_right = 176.0
margin_bottom = 79.0
hint_tooltip = "Camera perspective type.
Orthographic: Like a 2d game.
Perspective (Orbit): Like a 3d modeling app.
Perspective (FPS): Like minecraft.

HINT: Middle click drag to turn. Shift middle click drag to pan/translate.

HINT: Press j to toggle between orthographic preview modes/angles."
text = "Camera"

[node name="CursorBox" type="CSGBox" parent="."]
width = 1.1
height = 1.1
depth = 1.1
material = SubResource( 7 )

[node name="Mats" type="ScrollContainer" parent="."]
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
margin_top = -64.0
mouse_filter = 2

[node name="List" type="HBoxContainer" parent="Mats"]
margin_right = 1024.0
margin_bottom = 64.0
mouse_filter = 2
size_flags_horizontal = 3
size_flags_vertical = 3

[node name="Grid" type="Sprite3D" parent="."]
visible = false
cast_shadow = 0
pixel_size = 0.0625
texture = ExtResource( 6 )

[node name="VertEditPanel" type="Control" parent="."]
anchor_left = 1.0
anchor_right = 1.0
margin_left = -256.0
margin_bottom = 287.0
rect_clip_content = true
script = ExtResource( 7 )

[node name="Frame" type="ViewportContainer" parent="VertEditPanel"]
show_behind_parent = true
anchor_right = 1.0
anchor_bottom = 1.0
margin_bottom = -31.0
stretch = true

[node name="VertEditViewport" type="Viewport" parent="VertEditPanel/Frame"]
size = Vector2( 256, 256 )
own_world = true
world = SubResource( 20 )
handle_input_locally = false
render_target_update_mode = 3

[node name="DirectionalLight" type="DirectionalLight" parent="VertEditPanel/Frame/VertEditViewport"]
transform = Transform( -0.0871557, 0.880044, -0.466825, 0, 0.468608, 0.883406, 0.996195, 0.0769939, -0.0408419, 0, 2.26911, 2.99581 )

[node name="CameraHolder" type="Spatial" parent="VertEditPanel/Frame/VertEditViewport"]
transform = Transform( 0.866025, -0.25, 0.433013, 0, 0.866025, 0.5, -0.5, -0.433013, 0.75, 0, 0, 0 )

[node name="VertEditCamera" type="Camera" parent="VertEditPanel/Frame/VertEditViewport/CameraHolder"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 4 )
fov = 35.0

[node name="Grid" type="Sprite3D" parent="VertEditPanel/Frame/VertEditViewport"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0.51 )
pixel_size = 0.0078
texture = ExtResource( 10 )

[node name="Voxel" parent="VertEditPanel/Frame/VertEditViewport" instance=ExtResource( 1 )]
mesh = SubResource( 33 )
skeleton = NodePath("../../../..")

[node name="VertEditInputCatcher" type="Control" parent="VertEditPanel/Frame/VertEditViewport"]
anchor_right = 1.0
anchor_bottom = 1.0
script = ExtResource( 9 )

[node name="PlaneLock" type="Button" parent="VertEditPanel/Frame/VertEditViewport"]
toggle_mode = true
pressed = true
text = "Plane Lock"

[node name="Buttons" type="HBoxContainer" parent="VertEditPanel"]
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
margin_top = -31.0

[node name="Label" type="Label" parent="VertEditPanel/Buttons"]
margin_right = 46.0
margin_bottom = 31.0
text = "Vertex
Control"
align = 1

[node name="Left" type="Button" parent="VertEditPanel/Buttons"]
margin_left = 50.0
margin_right = 77.0
margin_bottom = 31.0
hint_tooltip = "Rotate Left"
custom_fonts/font = SubResource( 27 )
text = "↶"

[node name="Right" type="Button" parent="VertEditPanel/Buttons"]
margin_left = 81.0
margin_right = 108.0
margin_bottom = 31.0
hint_tooltip = "Rotate Right"
custom_fonts/font = SubResource( 27 )
text = "↷"

[node name="FlipH" type="Button" parent="VertEditPanel/Buttons"]
margin_left = 112.0
margin_right = 139.0
margin_bottom = 31.0
hint_tooltip = "Flip Horizontally"
custom_fonts/font = SubResource( 27 )
text = "↔"

[node name="FlipV" type="Button" parent="VertEditPanel/Buttons"]
margin_left = 143.0
margin_right = 170.0
margin_bottom = 31.0
hint_tooltip = "Flip Vertically"
custom_fonts/font = SubResource( 27 )
text = "↕"

[node name="Reset" type="Button" parent="VertEditPanel/Buttons"]
margin_left = 174.0
margin_right = 202.0
margin_bottom = 31.0
hint_tooltip = "Clear Vertex Edits"
custom_fonts/font = SubResource( 27 )
text = "❌"

[node name="ResetCamera" type="Button" parent="VertEditPanel/Buttons"]
margin_left = 206.0
margin_right = 229.0
margin_bottom = 31.0
hint_tooltip = "Reset Camera"
custom_fonts/font = SubResource( 27 )
text = "¬"

[node name="MenuBar" type="HBoxContainer" parent="."]
margin_left = 8.0
margin_top = 8.0
margin_right = 83.0
margin_bottom = 30.0
script = ExtResource( 11 )

[node name="File" type="MenuButton" parent="MenuBar"]
margin_right = 35.0
margin_bottom = 22.0
text = "File"
flat = false

[node name="Edit" type="MenuButton" parent="MenuBar"]
margin_left = 39.0
margin_right = 75.0
margin_bottom = 22.0
focus_mode = 2
text = "Edit"
flat = false
